---
title: Process&Thread
date: 2024-10-18
categories:
  - Technology
tags:
  - OS
nolastmod: true
cover: /img/pic-15.jpg
draft: true
---

# 进程
运行、就绪、阻塞
### 进程的控制结构
操作系统中，用进程控制块(process control block, PCB)数据结构来描述进程。
### 唤醒进程
进程由「运行」转变为「阻塞」状态是由于进程必须等待某一事件的完成，所以处于阻塞状态的进程绝对不可能叫醒自己。只有当该进程所期待的事件出现时，才由发现者进程用唤醒语句叫醒它。
### 进程上下文切换
进程由内核管理和调度，所以进程的切换只能发生在内核态。包括虚拟内存、栈、全局变量等用户空间的资源，以及内核堆栈、寄存器等内核空间的资源。
# 线程
线程是进程当中的一条执行流程。每个线程各自都有一套独立的寄存器和栈。
### 线程vs.进程
进程是资源分配的单位，线程是CPU调度的单位。线程独享的资源更少，如寄存器和栈。同一个进程内的线程切换比进程切换快，因为线程具有相同的地址空间(虚拟内存共享)，这意味着同一个进程的线程都具有同一个页表，对于进程之间的切换，页表的切换开销是比较大的。
### 线程上下文切换
当两个线程属于同一个进程，因为虚拟内存是共享的，所以在切换时，只需要切换线程的私有数据、寄存器等不共享的数据。
### 用户线程
* 优点：用户线程的切换由线程库函数完成，无需用户态与内核态的切换，速度特别快。
* 缺点：如果一个线程发起系统调用而阻塞，那进程所包含的用户线程都不能执行了；由于时间片分配给进程，故与其他进程比，每个线程得到的时间片较少。
### 内核线程
与用户线程相反，如果某个内核线程发起系统调用而阻塞，并不会影响其他内核线程的运行。但由于线程的创建、终止和切换都是通过系统调用来进行的，所以系统开销较大。
# 调度算法
1. 先来先服务（长作业有利，适合CPU繁忙型作业）
2. 最短作业优先（提高吞吐量）
3. 高响应比优先（优先权 = （等待时间+要求服务时间）/要求服务时间）
4. 时间片轮转调度算法（20ms-50ms）
5. 最高优先级调度
6. 多级反馈队列调度：每个队列优先级从高到低，同时优先级越高时间片越短。对于短作业可能在第一级队列很快被处理完，对于长作业，可以移入优先级更高的队列等待，兼顾了长短作业，同时有较好的响应时间。